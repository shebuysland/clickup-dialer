<!DOCTYPE html>
<html>
<head>
  <title>ClickUp Dialer</title>
</head>
<body>

<h3>ClickUp Dialer</h3>

<input type="text" id="phoneNumber" placeholder="+18557748713">
<button id="callBtn">Call</button>

<script src="https://sdk.twilio.com/js/voice/releases/2.3.0/twilio.min.js"></script>

<script>
let device;

async function initDevice() {
  try {
    console.log("Fetching token...");

    const response = await fetch("https://clickup-dialer-4911.twil.io/token?identity=agent1");
    const data = await response.json();

    console.log("Token received");

    device = new Twilio.Device(data.token, {
      logLevel: 1
    });

    device.on("registered", () => {
      console.log("Device registered and ready");
    });

    device.on("error", (error) => {
      console.error("Twilio Device Error:", error);
    });

    await device.register();

  } catch (err) {
    console.error("Initialization error:", err);
  }
}

initDevice();

document.getElementById("callBtn").addEventListener("click", async () => {

  if (!device) {
    console.error("Device not initialized");
    return;
  }

  const number = document.getElementById("phoneNumber").value;

  console.log("Calling:", number);

  try {
    await device.connect({
      params: { To: number }
    });
  } catch (err) {
    console.error("Call error:", err);
  }
});
</script>

</body>
</html>
