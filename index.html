<script src="https://sdk.twilio.com/js/voice/releases/2.3.0/twilio.min.js"></script>

<script>
let device;

async function init() {
  try {
    const response = await fetch("https://clickup-dialer-4911.twil.io/token?identity=agent1");
    const data = await response.json();

    device = new Twilio.Device(data.token, {
      logLevel: 1
    });

    device.on("registered", () => {
      console.log("Device ready");
    });

    device.on("error", (error) => {
      console.error("Twilio Error:", error);
    });

  } catch (err) {
    console.error("Init error:", err);
  }
}

init();

function makeCall() {
  if (!device) {
    console.error("Device not initialized");
    return;
  }

  const number = document.getElementById("phoneNumber").value;

  device.connect({
    params: { To: number }
  });

  console.log("Calling:", number);
}
</script>
